<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–™é‡‘è¨ˆç®—ãƒ»å¥‘ç´„ãƒ•ã‚©ãƒ¼ãƒ </title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f5f5f5;
    }
    #app-container {
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }
    .active-section {
      background-color: #FCF7DE;
    }
    .inactive-section {
      background-color: #e0e0e0;
      opacity: 0.6;
      pointer-events: none;
    }
    .process-active {
      background-color: #cfe2f3ff;
    }
    .process-inactive {
      background-color: #e0e0e0;
      opacity: 0.6;
    }
    .primary-button {
      background-color: #F58220;
      color: white;
    }
    .primary-button:hover {
      background-color: #d66d0a;
    }
    .secondary-button {
      background-color: #6B7280; /* Gray-500 */
      color: white;
    }
    .secondary-button:hover {
      background-color: #4B5563; /* Gray-600 */
    }
    .qr-placeholder {
      width: 300px;
      height: 300px;
      border: 2px dashed #666;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f0f0f0;
    }
    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: white;
      padding: 2rem;
      border-radius: 0.5rem;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="app-container"></div>
  
  <script type="text/babel">
    const App = () => {
     // æ–™é‡‘ãƒ—ãƒ©ãƒ³è¨­å®š
      const feeTable = {
        "ãƒ•ãƒ«ã‚¿ã‚¤ãƒ ": {
          "æœˆ2å›": 11480,
          "æœˆ3å›": 16220,
          "æœˆ4å›": 20960,
          "æœˆ6å›": 31440
        },
        "å¹³æ—¥ãƒ•ãƒ«": {
          "æœˆ2å›": 10300,
          "æœˆ3å›": 14450,
          "æœˆ4å›": 18600,
          "æœˆ6å›": 27900
        },
        "ã„ã¤ã§ã‚‚å¤•æ–¹": {
          "æœˆ2å›": 9190,
          "æœˆ3å›": 12780,
          "æœˆ4å›": 16380,
          "æœˆ6å›": 24570
        }
      };

      // çŠ¶æ…‹ç®¡ç†
      const [currentStep, setCurrentStep] = React.useState(1);
      const [plan, setPlan] = React.useState("");
      const [frequency, setFrequency] = React.useState("");
      const [nextMonthPlan, setNextMonthPlan] = React.useState("");
      const [nextMonthFrequency, setNextMonthFrequency] = React.useState("");
      
      const [joinAtTrial, setJoinAtTrial] = React.useState(true);
      
      // ã‚¯ãƒ¼ãƒãƒ³é–¢é€£ã®çŠ¶æ…‹
      const [couponCode, setCouponCode] = React.useState("");
      const [applyCoupon, setApplyCoupon] = React.useState(false);

      const [startTiming, setStartTiming] = React.useState("ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹");
      const [changePlanNextMonth, setChangePlanNextMonth] = React.useState(false);
      const [showPlanChangeForm, setShowPlanChangeForm] = React.useState(false);
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ç®¡ç†ç”¨
      const [showDeadlineModal, setShowDeadlineModal] = React.useState(false);
      const [deadlineMessage, setDeadlineMessage] = React.useState("");
      // æœŸé™åˆ‡ã‚Œã«ã‚ˆã‚‹å¤‰æ›´é©ç”¨é…å»¶ãƒ•ãƒ©ã‚°
      const [isDelayedChange, setIsDelayedChange] = React.useState(false);
      
      // é‡‘é¡è¨ˆç®—
      const [thisMonthFee, setThisMonthFee] = React.useState(0);
      const [nextMonthFee, setNextMonthFee] = React.useState(0);
      const [registrationFee, setRegistrationFee] = React.useState(5950);
      const [thisMonthTotal, setThisMonthTotal] = React.useState(0);
      const [nextMonthTotal, setNextMonthTotal] = React.useState(0);

      // æ—¥ä»˜é–¢é€£
      const today = new Date();
      // today.setDate(15); // â˜…ãƒ†ã‚¹ãƒˆç”¨ï¼šã“ã“ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨15æ—¥ã¨ã—ã¦å‹•ä½œç¢ºèªã§ãã¾ã™

      // é©ç”¨æœˆï¼ˆæ¥æœˆã¾ãŸã¯å†æ¥æœˆï¼‰ã®è¨ˆç®—
      const targetMonthOffset = isDelayedChange ? 2 : 1;
      const nextMonth = new Date(today.getFullYear(), today.getMonth() + targetMonthOffset, 1);
      
      // UIè¡¨ç¤ºç”¨ã®ãƒ©ãƒ™ãƒ«ï¼ˆã€Œæ¥æœˆã€ã¾ãŸã¯ã€Œâ—‹æœˆä»¥é™ã€ï¼‰
      const nextMonthLabel = isDelayedChange ? `${nextMonth.getMonth() + 1}æœˆä»¥é™` : "æ¥æœˆ";
      
      const formatDate = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        return `${year}å¹´${month}æœˆ${day}æ—¥`;
      };

      // åˆ©ç”¨é–‹å§‹æ—¥ã®è¨ˆç®—
      const getStartDate = () => {
        if (startTiming === "ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹") {
          return formatDate(today);
        } else {
          // ã€Œæ¥æœˆã‹ã‚‰å§‹ã‚ã‚‹ã€ã®å ´åˆã€ç´”ç²‹ãªæ¥æœˆ1æ—¥ã‚’è¿”ã™
          const pureNextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
          return formatDate(pureNextMonth);
        }
      };

      // å¼•è½é–‹å§‹æ—¥ï¼ˆå¸¸ã«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã®æ¥æœˆ1æ—¥ï¼‰
      const getPaymentStartDate = () => {
        const paymentDate = new Date(today.getFullYear(), today.getMonth() + 1, 1);
        return formatDate(paymentDate);
      };

      // ãƒ—ãƒ©ãƒ³å¤‰æ›´ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒã‚ªãƒ•ã«ãªã£ãŸã‚‰é…å»¶ãƒ•ãƒ©ã‚°ã‚‚ãƒªã‚»ãƒƒãƒˆ
      React.useEffect(() => {
        if (!changePlanNextMonth) {
          setIsDelayedChange(false);
        }
      }, [changePlanNextMonth]);

      // ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰ã®ç›£è¦–
      React.useEffect(() => {
        if (couponCode === "ayuiida2026") {
          setApplyCoupon(true);
        } else {
          setApplyCoupon(false);
        }
      }, [couponCode]);

      // é‡‘é¡ã‚’å†è¨ˆç®—
      React.useEffect(() => {
        let currentRegistrationFee;
        if (applyCoupon) {
          currentRegistrationFee = 3950;
        } else {
          currentRegistrationFee = joinAtTrial ? registrationFee - 1000 : registrationFee;
        }

        if (!plan || !frequency) {
          setThisMonthFee(0);
          setNextMonthFee(0);
          setThisMonthTotal(currentRegistrationFee);
          setNextMonthTotal(0);
          return;
        }
        
        const monthlyFee = feeTable[plan][frequency];
        
        if (startTiming === "ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹") {
          setThisMonthFee(monthlyFee);
          if (changePlanNextMonth && nextMonthPlan && nextMonthFrequency) {
            setNextMonthFee(feeTable[nextMonthPlan][nextMonthFrequency]);
          } else {
            setNextMonthFee(monthlyFee);
          }
          setThisMonthTotal(currentRegistrationFee + monthlyFee);
        } else {
          setThisMonthFee(0);
          setNextMonthFee(monthlyFee);
          setThisMonthTotal(currentRegistrationFee);
        }
        
        setNextMonthTotal(nextMonthFee);
      }, [plan, frequency, joinAtTrial, applyCoupon, startTiming, changePlanNextMonth, nextMonthPlan, nextMonthFrequency, nextMonthFee, registrationFee]);

      // éŸ³å£°å†ç”Ÿ
      React.useEffect(() => {
        if (currentStep === 3) {
          const audio = new Audio('./å‘¼ã³å‡ºã—éŸ³.mp3');
          audio.volume = 0.5;
          audio.play().catch(error => {
            console.log('éŸ³å£°ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
          });
        }
      }, [currentStep]);

      // QRã‚³ãƒ¼ãƒ‰ã«è¡¨ç¤ºã™ã¹ããƒ—ãƒ©ãƒ³ã¨å›æ•°ã‚’æ±ºå®šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
      const getQRTarget = () => {
        let targetPlan = plan;
        let targetFrequency = frequency;

        if (changePlanNextMonth) {
          // æœ¬æ—¥ãŒ10æ—¥ä»¥å‰ãªã‚‰ã€Œæ¥æœˆã®ãƒ—ãƒ©ãƒ³ï¼ˆæ–°ãƒ—ãƒ©ãƒ³ï¼‰ã€ã‚’è¡¨ç¤º
          if (today.getDate() <= 10) {
            targetPlan = nextMonthPlan;
            targetFrequency = nextMonthFrequency;
          }
          // æœ¬æ—¥ãŒ11æ—¥ä»¥é™ãªã‚‰ã€Œä»Šæœˆã®ãƒ—ãƒ©ãƒ³ï¼ˆæ—§ãƒ—ãƒ©ãƒ³ï¼‰ã€ã®ã¾ã¾
        }
        
        return { targetPlan, targetFrequency };
      };

      // QRã‚³ãƒ¼ãƒ‰ç”»åƒãƒ‘ã‚¹ç”Ÿæˆ
      const getQRImagePath = () => {
        const planMap = {
          "ãƒ•ãƒ«ã‚¿ã‚¤ãƒ ": "fulltime",
          "å¹³æ—¥ãƒ•ãƒ«": "weekday",
          "ã„ã¤ã§ã‚‚å¤•æ–¹": "evening"
        };
        const frequencyMap = {
          "æœˆ2å›": "2",
          "æœˆ3å›": "3",
          "æœˆ4å›": "4",
          "æœˆ6å›": "6"
        };
        
        const { targetPlan, targetFrequency } = getQRTarget();
        
        if (targetPlan && targetFrequency) {
          const datePrefix = "20260101"; //æœˆè¬ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã“ã“ã‚’å¤‰ãˆã‚‹
          const path = `./images/${datePrefix}-${planMap[targetPlan]}-${frequencyMap[targetFrequency]}.png`;
          return path;
        }
        return "";
      };

      // QRã‚³ãƒ¼ãƒ‰ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
      const getQRPlaceholderText = () => {
        const { targetPlan, targetFrequency } = getQRTarget();
        return `${targetPlan}\n${targetFrequency}\nQRã‚³ãƒ¼ãƒ‰`;
      };

      const getDisplayRegistrationFee = () => {
        if (applyCoupon) return 3950;
        return joinAtTrial ? registrationFee - 1000 : registrationFee;
      };

      // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¸é€²ã‚€å‡¦ç†ï¼ˆå…±é€šåŒ–ï¼‰
      const proceedToNextStep = () => {
        setCurrentStep(2);
        setTimeout(() => {
          document.getElementById('section-2')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
      };

      // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç”¨ã®å¤‰æ•°æº–å‚™ï¼ˆQRã‚³ãƒ¼ãƒ‰è¡¨ç¤ºåˆ¤å®šç”¨ï¼‰
      const { targetPlan: qrPlan, targetFrequency: qrFreq } = getQRTarget();

      return (
        <div className="h-screen flex flex-col bg-gray-100">
          {/* ãƒ—ãƒ­ã‚»ã‚¹è¡¨ç¤ºéƒ¨åˆ† */}
          <div className="bg-white shadow-md p-4">
            <div className="flex justify-center items-center space-x-2">
              <div className={`px-4 py-2 rounded-lg font-bold text-sm ${currentStep === 1 ? 'process-active' : 'process-inactive'}`}>
                â‘ ãƒ—ãƒ©ãƒ³æ±ºã‚
              </div>
              <div className="text-xl">â†’</div>
              <div className={`px-4 py-2 rounded-lg font-bold text-sm ${currentStep === 2 ? 'process-active' : 'process-inactive'}`}>
                â‘¡ç¢ºèªæ›¸
              </div>
              {showPlanChangeForm && (
                <>
                  <div className="text-xl">â†’</div>
                  <div className={`px-4 py-2 rounded-lg font-bold text-sm ${currentStep === 2.5 ? 'process-active' : 'process-inactive'}`}>
                    â‘¡-2ãƒ—ãƒ©ãƒ³å¤‰æ›´å±Š
                  </div>
                </>
              )}
              <div className="text-xl">â†’</div>
              <div className={`px-4 py-2 rounded-lg font-bold text-sm ${currentStep === 3 ? 'process-active' : 'process-inactive'}`}>
                â‘¢ãŠä¼šè¨ˆ
              </div>
              <div className="text-xl">â†’</div>
              <div className={`px-4 py-2 rounded-lg font-bold text-sm ${currentStep === 4 ? 'process-active' : 'process-inactive'}`}>
                â‘£å¼•ãè½ã¨ã—ç™»éŒ²
              </div>
              <div className="text-xl">â†’</div>
              <div className="px-4 py-2 rounded-lg font-bold text-sm process-inactive">
                â‘¤å®Œäº†
              </div>
            </div>
          </div>

          {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
          <div className="flex-1 p-4 lg:p-8 overflow-auto">
            <div className="max-w-7xl mx-auto space-y-6">
              
              {/* â‘ ãƒ—ãƒ©ãƒ³æ±ºã‚ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
              <div id="section-1" className={`p-6 rounded-lg shadow-lg ${currentStep === 1 ? 'active-section' : 'inactive-section'}`}>
                <h2 className="text-2xl font-bold mb-6 text-center">â‘ ãƒ—ãƒ©ãƒ³ã‚’æ±ºã‚ã‚ˆã†</h2>
                
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                  {/* å·¦å´ï¼šå…¥åŠ› */}
                  <div className="space-y-4">
                    <div className={changePlanNextMonth ? 'bg-white p-4 rounded-lg' : ''}>
                      <div>
                        <label className="block mb-2 font-medium text-lg">
                          {changePlanNextMonth ? 'ä»Šæœˆã®ãƒ—ãƒ©ãƒ³' : 'ãƒ—ãƒ©ãƒ³'}
                        </label>
                        <select 
                          className="w-full p-3 border rounded text-lg"
                          value={plan}
                          onChange={(e) => setPlan(e.target.value)}
                          disabled={currentStep !== 1}
                        >
                          <option value="" disabled>ãƒ—ãƒ©ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„</option>
                          <option value="ãƒ•ãƒ«ã‚¿ã‚¤ãƒ ">ãƒ•ãƒ«ã‚¿ã‚¤ãƒ </option>
                          <option value="å¹³æ—¥ãƒ•ãƒ«">å¹³æ—¥ãƒ•ãƒ«</option>
                          <option value="ã„ã¤ã§ã‚‚å¤•æ–¹">ã„ã¤ã§ã‚‚å¤•æ–¹</option>
                        </select>
                      </div>
                      
                      <div className="mt-4">
                        <label className="block mb-2 font-medium text-lg">
                          {changePlanNextMonth ? 'ä»Šæœˆã®å›æ•°' : 'å›æ•°'}
                        </label>
                        <select 
                          className="w-full p-3 border rounded text-lg"
                          value={frequency}
                          onChange={(e) => setFrequency(e.target.value)}
                          disabled={currentStep !== 1}
                        >
                          <option value="" disabled>å›æ•°ã‚’é¸ã‚“ã§ãã ã•ã„</option>
                          <option value="æœˆ2å›">æœˆ2å›</option>
                          <option value="æœˆ3å›">æœˆ3å›</option>
                          <option value="æœˆ4å›">æœˆ4å›</option>
                          <option value="æœˆ6å›">æœˆ6å›</option>
                        </select>
                      </div>
                    </div>
                    
                    <div className="flex items-center">
                      <input 
                        type="checkbox" 
                        id="joinAtTrial" 
                        className="mr-3 h-5 w-5"
                        checked={joinAtTrial}
                        onChange={(e) => setJoinAtTrial(e.target.checked)}
                        disabled={currentStep !== 1}
                      />
                      <label htmlFor="joinAtTrial" className="text-lg">ä½“é¨“æ™‚ã«å…¥ä¼š</label>
                    </div>

                    {/* ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰å…¥åŠ›ã‚¨ãƒªã‚¢ */}
                    <div className="mt-2">
                      <label className="block mb-2 font-medium text-lg">ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰</label>
                      <input
                        type="text"
                        className="w-full p-3 border rounded text-lg"
                        value={couponCode}
                        onChange={(e) => setCouponCode(e.target.value)}
                        placeholder="ãŠæŒã¡ã®æ–¹ã¯å…¥åŠ›ã—ã¦ãã ã•ã„"
                        disabled={currentStep !== 1}
                      />
                      {couponCode !== "" && !applyCoupon && (
                        <p className="text-red-600 font-bold mt-1">ã‚³ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™</p>
                      )}
                      {applyCoupon && (
                        <p className="text-green-600 font-bold mt-1">ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã—ã¾ã—ãŸï¼</p>
                      )}
                    </div>
                    
                    <div className="space-y-3 mt-4">
                      <div className="flex items-center">
                        <input 
                          type="radio" 
                          id="startThisMonth" 
                          name="startTiming"
                          className="mr-3 h-5 w-5"
                          value="ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹"
                          checked={startTiming === "ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹"}
                          onChange={(e) => setStartTiming(e.target.value)}
                          disabled={currentStep !== 1}
                        />
                        <label htmlFor="startThisMonth" className="text-lg">ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹</label>
                      </div>
                      
                      {startTiming === "ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹" && (
                        <div className="flex items-center ml-8">
                          <input 
                            type="checkbox" 
                            id="changePlanNextMonth" 
                            className="mr-3 h-5 w-5"
                            checked={changePlanNextMonth}
                            onChange={(e) => setChangePlanNextMonth(e.target.checked)}
                            disabled={currentStep !== 1}
                          />
                          <label htmlFor="changePlanNextMonth" className="text-lg">ä»Šæœˆã¨æ¥æœˆã§ãƒ—ãƒ©ãƒ³ã‚’å¤‰ãˆã‚‹</label>
                        </div>
                      )}
                      
                      <div className="flex items-center">
                        <input 
                          type="radio" 
                          id="startNextMonth" 
                          name="startTiming"
                          className="mr-3 h-5 w-5"
                          value="æ¥æœˆã‹ã‚‰å§‹ã‚ã‚‹"
                          checked={startTiming === "æ¥æœˆã‹ã‚‰å§‹ã‚ã‚‹"}
                          onChange={(e) => setStartTiming(e.target.value)}
                          disabled={currentStep !== 1}
                        />
                        <label htmlFor="startNextMonth" className="text-lg">æ¥æœˆã‹ã‚‰å§‹ã‚ã‚‹</label>
                      </div>
                    </div>
                    
                    {changePlanNextMonth && startTiming === "ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹" && (
                      <div className="bg-white p-4 rounded-lg mt-4">
                        <div>
                          <label className="block mb-2 font-medium text-lg">{nextMonthLabel}ã®ãƒ—ãƒ©ãƒ³</label>
                          <select 
                            className="w-full p-3 border rounded text-lg"
                            value={nextMonthPlan}
                            onChange={(e) => setNextMonthPlan(e.target.value)}
                            disabled={currentStep !== 1}
                          >
                            <option value="" disabled>ãƒ—ãƒ©ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„</option>
                            <option value="ãƒ•ãƒ«ã‚¿ã‚¤ãƒ ">ãƒ•ãƒ«ã‚¿ã‚¤ãƒ </option>
                            <option value="å¹³æ—¥ãƒ•ãƒ«">å¹³æ—¥ãƒ•ãƒ«</option>
                            <option value="ã„ã¤ã§ã‚‚å¤•æ–¹">ã„ã¤ã§ã‚‚å¤•æ–¹</option>
                          </select>
                        </div>
                        
                        <div className="mt-4">
                          <label className="block mb-2 font-medium text-lg">{nextMonthLabel}ã®å›æ•°</label>
                          <select 
                            className="w-full p-3 border rounded text-lg"
                            value={nextMonthFrequency}
                            onChange={(e) => setNextMonthFrequency(e.target.value)}
                            disabled={currentStep !== 1}
                          >
                            <option value="" disabled>å›æ•°ã‚’é¸ã‚“ã§ãã ã•ã„</option>
                            <option value="æœˆ2å›">æœˆ2å›</option>
                            <option value="æœˆ3å›">æœˆ3å›</option>
                            <option value="æœˆ4å›">æœˆ4å›</option>
                            <option value="æœˆ6å›">æœˆ6å›</option>
                          </select>
                        </div>
                      </div>
                    )}
                  </div>
                  
                  {/* å³å´ï¼šè¨ˆç®—çµæœ */}
                  <div className="space-y-4">
                    <h3 className="font-bold text-xl border-b pb-2">ä»Šæœˆã®è²»ç”¨</h3>
                    <div className="flex justify-between items-baseline text-lg">
                      <span>å…¥ä¼šè²»</span>
                      <span>
                        {getDisplayRegistrationFee().toLocaleString()}<span className="text-sm">å††</span>
                        {applyCoupon && <span className="text-red-600 font-bold ml-2 text-sm">2000å††å¼•ãï¼</span>}
                      </span>
                    </div>
                    <div className="flex justify-between items-baseline text-lg">
                      <span>æœˆè¬</span>
                      <span>{thisMonthFee.toLocaleString()}<span className="text-sm">å††</span></span>
                    </div>
                    <div className="flex justify-between items-baseline font-bold text-xl border-t pt-2">
                      <span>ä»Šæœˆåˆè¨ˆ</span>
                      <span>{thisMonthTotal.toLocaleString()}<span className="text-sm">å††</span></span>
                    </div>
                    
                    <h3 className={`font-bold text-xl border-b pb-2 ${changePlanNextMonth && startTiming === "ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹" ? 'mt-32' : 'mt-6'}`}>
                      {nextMonthLabel}ã®è²»ç”¨
                    </h3>
                    <div className="flex justify-between items-baseline text-lg">
                      <span>æœˆè¬</span>
                      <span>{nextMonthFee.toLocaleString()}<span className="text-sm">å††</span></span>
                    </div>
                    <div className="flex justify-between items-baseline font-bold text-xl border-t pt-2">
                      <span>{nextMonthLabel}åˆè¨ˆ</span>
                      <span>{nextMonthTotal.toLocaleString()}<span className="text-sm">å††</span></span>
                    </div>
                  </div>
                </div>
                
                <div className="mt-8 flex justify-between">
                  <button 
                    className="primary-button px-8 py-4 rounded-lg text-xl font-bold disabled:opacity-50"
                    onClick={() => {
                      if (changePlanNextMonth && today.getDate() >= 11 && !isDelayedChange) {
                        const targetMonth = new Date(today.getFullYear(), today.getMonth() + 2, 1).getMonth() + 1;
                        setDeadlineMessage(`æœ¬æ—¥ã¯ãƒ—ãƒ©ãƒ³å¤‰æ›´æœŸé™ã®10æ—¥ã‚’éãã¦ã„ã¾ã™ã€‚ãƒ—ãƒ©ãƒ³å¤‰æ›´ã®é©ç”¨ã¯${targetMonth}æœˆã«ãªã‚Šã¾ã™`);
                        setShowDeadlineModal(true);
                        return;
                      }
                      proceedToNextStep();
                    }}
                    disabled={!plan || !frequency || (changePlanNextMonth && (!nextMonthPlan || !nextMonthFrequency))}
                  >
                    ãƒ—ãƒ©ãƒ³ç¢ºå®šï¼ˆæ¬¡ã¸ï¼‰
                  </button>
                </div>
              </div>

              {/* â‘¡ç¢ºèªæ›¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
              <div id="section-2" className={`p-6 rounded-lg shadow-lg ${currentStep === 2 ? 'active-section' : 'inactive-section'}`}>
                <h2 className="text-2xl font-bold mb-6 text-center">â‘¡ç¢ºèªæ›¸ã‚’æ›¸ã“ã†</h2>
                
                <div className="max-w-2xl mx-auto space-y-6">
                  <div className="bg-white p-6 rounded-lg space-y-4">
                    <div className="flex items-center space-x-4">
                      <span className="font-medium text-lg">ãƒ—ãƒ©ãƒ³åï¼š</span>
                      <span className="text-xl font-bold text-red-600 border-2 border-red-600 rounded-full px-4 py-1">
                        {plan || "æœªé¸æŠ"}
                      </span>
                    </div>
                    
                    <div className="flex items-center space-x-4">
                      <span className="font-medium text-lg">å›æ•°ï¼š</span>
                      <span className="text-xl font-bold text-red-600 border-2 border-red-600 rounded-full px-4 py-1">
                        {frequency || "æœªé¸æŠ"}
                      </span>
                    </div>
                    
                    <div className="flex items-center space-x-4">
                      <span className="font-medium text-lg">åˆ©ç”¨é–‹å§‹æ—¥ï¼š</span>
                      <span className="text-xl font-bold">{getStartDate()}</span>
                    </div>
                    
                    <div className="flex items-center space-x-4">
                      <span className="font-medium text-lg">å¼•è½é–‹å§‹æ—¥ï¼š</span>
                      <span className="text-xl font-bold">{getPaymentStartDate()}</span>
                    </div>
                    
                    <div className="space-y-2">
                      {changePlanNextMonth && nextMonthPlan && nextMonthFrequency ? (
                        <>
                          <div className="flex items-center space-x-4">
                            <span className="font-medium text-lg">æœˆè¬ï¼ˆä»Šæœˆï¼‰ï¼š</span>
                            <span className="text-xl font-bold">
                              {thisMonthFee.toLocaleString()}å††
                            </span>
                          </div>
                          <div className="flex items-center space-x-4">
                            <span className="font-medium text-lg">æœˆè¬ï¼ˆ{nextMonthLabel}ï¼‰ï¼š</span>
                            <span className="text-xl font-bold">
                              {nextMonthFee.toLocaleString()}å††
                            </span>
                          </div>
                        </>
                      ) : (
                        <div className="flex items-center space-x-4">
                          <span className="font-medium text-lg">æœˆé¡ï¼š</span>
                          <span className="text-xl font-bold">
                            {(plan && frequency) ? feeTable[plan][frequency].toLocaleString() : 0}å††
                          </span>
                        </div>
                      )}
                    </div>
                  </div>
                  
                  <div className="text-center text-lg font-medium text-gray-700 mt-6">
                    â‘¡ç¢ºèªäº‹é …ã¨â‘¢ã”ç½²åã¾ã§è¨˜å…¥ã‚’ãŠé¡˜ã„ã—ã¾ã™
                  </div>
                  
                  <div className="flex justify-between mt-8">
                    {/* ã€ä¿®æ­£ã€‘æˆ»ã‚‹ãƒœã‚¿ãƒ³ã§isDelayedChangeã‚’ãƒªã‚»ãƒƒãƒˆ */}
                    <button 
                      className="px-6 py-3 bg-gray-500 text-white rounded-lg text-lg font-bold hover:bg-gray-600"
                      onClick={() => {
                        setIsDelayedChange(false);
                        setCurrentStep(1);
                        setTimeout(() => {
                          document.getElementById('section-1')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                      }}
                    >
                      æˆ»ã‚‹
                    </button>
                    <button 
                      className="primary-button px-6 py-3 rounded-lg text-lg font-bold"
                      onClick={() => {
                        const hasChange = changePlanNextMonth && startTiming === "ä»Šæœˆã‹ã‚‰å§‹ã‚ã‚‹" && plan && frequency && nextMonthPlan && nextMonthFrequency;
                        if (hasChange) {
                          setCurrentStep(2.5);
                          setTimeout(() => {
                            document.getElementById('section-2-5')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                          }, 100);
                        } else {
                          setCurrentStep(3);
                          setTimeout(() => {
                            document.getElementById('section-3')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                          }, 100);
                        }
                      }}
                    >
                      æ¬¡ã¸
                    </button>
                  </div>
                </div>
              </div>

              {/* â‘¡-2ãƒ—ãƒ©ãƒ³å¤‰æ›´å±Šã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
              <div id="section-2-5" className={`p-6 rounded-lg shadow-lg ${currentStep === 2.5 ? 'active-section' : 'inactive-section'}`}>
                  <h2 className="text-2xl font-bold mb-6 text-center">ãƒ—ãƒ©ãƒ³å¤‰æ›´å±Šã‚’æ›¸ã“ã†</h2>
                  
                  <div className="max-w-2xl mx-auto space-y-6">
                    <div className="text-gray-700 space-y-2 mb-4">
                      <p>â‘ ãŠåå‰ã€ç”Ÿå¹´æœˆæ—¥ã€é›»è©±ç•ªå·ã‚’ã”è¨˜å…¥ãã ã•ã„</p>
                      <p>â‘¡ç¢ºèªäº‹é …ã‚’ãŠèª­ã¿ã«ãªã‚Šã€â–¡ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„</p>
                    </div>
                    
                    <div className="bg-white p-6 rounded-lg space-y-4">
                      <h3 className="text-xl font-bold mb-4">â‘¢</h3>
                      
                      <div className="space-y-3">
                        <div className="flex items-center space-x-4">
                          <span className="font-medium">ç”³è¾¼æ—¥ï¼š</span>
                          <span className="font-bold">{formatDate(today)}</span>
                        </div>
                        
                        <div className="flex items-center space-x-4">
                          <span className="font-medium">å¤‰æ›´å‰ã®ãƒ—ãƒ©ãƒ³ï¼š</span>
                          <span className="font-bold">{plan} {frequency}</span>
                        </div>
                        
                        <div className="flex items-center space-x-4">
                          <span className="font-medium text-lg">å¤‰æ›´å¾Œã®ãƒ—ãƒ©ãƒ³ï¼š</span>
                          <span className="font-bold">{nextMonthPlan} {nextMonthFrequency}</span>
                        </div>
                        
                        <div className="flex items-center space-x-4">
                          <span className="font-medium">å¤‰æ›´é©ç”¨æ—¥ï¼š</span>
                          <span className="font-bold">{formatDate(nextMonth)}</span>
                        </div>
                      </div>
                    </div>
                    
                    <div className="flex justify-between mt-8">
                      <button 
                        className="px-6 py-3 bg-gray-500 text-white rounded-lg text-lg font-bold hover:bg-gray-600"
                        onClick={() => {
                          setCurrentStep(2);
                          setTimeout(() => {
                            document.getElementById('section-2')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                          }, 100);
                        }}
                      >
                        æˆ»ã‚‹
                      </button>
                      <button 
                        className="primary-button px-6 py-3 rounded-lg text-lg font-bold"
                        onClick={() => {
                          setCurrentStep(3);
                          setTimeout(() => {
                            document.getElementById('section-3')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                          }, 100);
                        }}
                      >
                        æ¬¡ã¸
                      </button>
                    </div>
                  </div>
                </div>

              {/* â‘¢ãŠä¼šè¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
              <div id="section-3" className={`p-6 rounded-lg shadow-lg ${currentStep === 3 ? 'active-section' : 'inactive-section'}`}>
                <h2 className="text-2xl font-bold mb-2 text-center">â‘¢ä»Šæœˆã®ãŠä¼šè¨ˆã‚’ã—ã‚ˆã†</h2>
                <p className="text-center text-lg text-gray-700 mb-6">å…ˆç”Ÿã‚’å‘¼ã‚“ã§ã­</p>
                
                <div className="max-w-2xl mx-auto">
                  <div className="bg-white p-6 rounded-lg space-y-4">
                    <h3 className="font-bold text-xl border-b pb-2">ä»Šæœˆã®è²»ç”¨</h3>
                    <div className="flex justify-between items-baseline text-lg">
                      <span>å…¥ä¼šè²»</span>
                      <span>
                         {getDisplayRegistrationFee().toLocaleString()}<span className="text-sm">å††</span>
                         {applyCoupon && <span className="text-red-600 font-bold ml-2 text-sm">2000å††å¼•ãï¼</span>}
                      </span>
                    </div>
                    <div className="flex justify-between items-baseline text-lg">
                      <span>æœˆè¬</span>
                      <span>{thisMonthFee.toLocaleString()}<span className="text-sm">å††</span></span>
                    </div>
                    <div className="flex justify-between items-baseline font-bold text-xl border-t pt-2">
                      <span>ä»Šæœˆåˆè¨ˆ</span>
                      <span>{thisMonthTotal.toLocaleString()}<span className="text-sm">å††</span></span>
                    </div>
                  </div>
                  
                  <div className="flex items-center justify-between mt-8">
                    <button 
                      className="px-6 py-3 bg-gray-500 text-white rounded-lg text-lg font-bold hover:bg-gray-600"
                      onClick={() => {
                        const prevStep = showPlanChangeForm ? 2.5 : 2;
                        setCurrentStep(prevStep);
                        setTimeout(() => {
                          const sectionId = showPlanChangeForm ? 'section-2-5' : 'section-2';
                          document.getElementById(sectionId)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                      }}
                    >
                      æˆ»ã‚‹
                    </button>
                    <div className="flex items-center space-x-4">
                      <div className="text-right">
                        <p className="text-sm font-medium text-gray-700">ä»Šæœˆåˆ†ãƒ»ãƒ»ãƒ»<span style={{color: '#10B981'}}>OKï¼</span><span>âœ…</span></p>
                        <p className="text-sm font-medium text-gray-700">æ¥æœˆä»¥é™ãƒ»ãƒ»ãƒ»â†’</p>
                      </div>
                      <button 
                        className="primary-button px-6 py-3 rounded-lg text-lg font-bold"
                        onClick={() => {
                          setCurrentStep(4);
                          setTimeout(() => {
                            document.getElementById('section-4')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                          }, 100);
                        }}
                      >
                        æ¬¡ã¸
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              {/* â‘£å¼•ãè½ã¨ã—ç™»éŒ²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
              <div id="section-4" className={`p-6 rounded-lg shadow-lg ${currentStep === 4 ? 'active-section' : 'inactive-section'}`}>
                <h2 className="text-2xl font-bold mb-6 text-center">â‘£æ¥æœˆã®å¼•ãè½ã¨ã—ç™»éŒ²</h2>
                
                <div className="flex flex-col items-center space-y-6">
                  {(qrPlan && qrFreq) ? (
                    <img 
                      src={getQRImagePath()} 
                      alt={`${qrPlan} ${qrFreq} QRã‚³ãƒ¼ãƒ‰`}
                      style={{ 
                        width: "300px", 
                        height: "300px", 
                        objectFit: "contain",
                        border: "1px solid #ddd" 
                      }}
                      onError={(e) => {
                        console.error("ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:", e.target.src);
                        e.target.style.display = 'none';
                        e.target.nextSibling.style.display = 'flex';
                      }}
                    />
                  ) : null}
                  <div 
                    className="qr-placeholder" 
                    style={{ 
                      display: (qrPlan && qrFreq) ? 'none' : 'flex',
                      width: "300px",
                      height: "300px"
                    }}
                  >
                    <div className="text-center">
                      <p className="text-sm">{getQRPlaceholderText()}</p>
                    </div>
                  </div>
                  
                  <div className="text-xl font-medium">
                    ã”è‡ªèº«ã®ã‚¹ãƒãƒ›ã§ğŸ‘†ã®QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã£ã¦ã­ï¼
                  </div>
                  
                  {/* ã€ä¿®æ­£ã€‘ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ã®æœ€å¤§å¹…ã‚’è¨­å®šã—ã¦ä»–ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨åˆã‚ã›ã‚‹ */}
                  <div className="flex justify-between mt-8 w-full max-w-2xl">
                    <button 
                      className="px-6 py-3 bg-gray-500 text-white rounded-lg text-lg font-bold hover:bg-gray-600"
                      onClick={() => {
                        setCurrentStep(3);
                        setTimeout(() => {
                          document.getElementById('section-3')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                      }}
                    >
                      æˆ»ã‚‹
                    </button>
                    <button 
                      className="primary-button px-6 py-3 rounded-lg text-lg font-bold"
                      onClick={() => window.open('https://docs.google.com/presentation/d/1Gs0pot3LOPsm4jWxTZMrTJTfiLsSv0snkms8wMlmvyc/present?slide=id.g35e05055ccb_2_27#slide=id.g35e05055ccb_2_27', '_blank')}
                    >
                      æ¬¡ã¸ï¼ˆæ“ä½œæ–¹æ³•ï¼‰
                    </button>
                  </div>
                </div>
              </div>
              
            </div>
          </div>

          {/* ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºéƒ¨åˆ† */}
          {showDeadlineModal && (
            <div className="modal-overlay">
              <div className="modal-content">
                <p className="text-xl font-bold text-red-600 mb-4">ç¢ºèª</p>
                <p className="text-lg mb-8 font-bold">{deadlineMessage}</p>
                <div className="flex justify-center space-x-6">
                  {/* ã„ã„ãˆãƒœã‚¿ãƒ³ */}
                  <button
                    className="secondary-button px-10 py-3 rounded-lg text-lg font-bold"
                    onClick={() => {
                      setChangePlanNextMonth(false);
                      setShowDeadlineModal(false);
                    }}
                  >
                    ã„ã„ãˆ
                  </button>
                  {/* ã¯ã„ãƒœã‚¿ãƒ³ */}
                  <button
                    className="primary-button px-10 py-3 rounded-lg text-lg font-bold"
                    onClick={() => {
                      setIsDelayedChange(true);
                      setShowDeadlineModal(false);
                      proceedToNextStep();
                    }}
                  >
                    ã¯ã„
                  </button>
                </div>
              </div>
            </div>
          )}

        </div>
      );
    };

    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    ReactDOM.render(
      <App />,
      document.getElementById('app-container')
    );
  </script>
</body>
</html>
